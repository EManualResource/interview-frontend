{
    "type": "reply",
    "tag": "javascript",
    "difficulty": "1",
    "from": "https://github.com/qiu-deqing/fe-interview",
    "description": "<p>编写一个函数接受url中query string为参数,返回解析后的Object,query string使用application/x-www-form-urlencoded编码</p>\n",
    "answer": "<pre><code>/**\n * 解析query string转换为对象，一个key有多个值时生成数组\n *\n * @param {String} query 需要解析的query字符串，开头可以是?，\n * 按照application/x-www-form-urlencoded编码\n * @return {Object} 参数解析后的对象\n */\nfunction parseQuery(query) {\n    var result = {};\n\n    // 如果不是字符串返回空对象\n    if (typeof query !== &#39;string&#39;) {\n        return result;\n    }\n\n    // 去掉字符串开头可能带的?\n    if (query.charAt(0) === &#39;?&#39;) {\n        query = query.substring(1);\n    }\n\n    var pairs = query.split(&#39;&amp;&#39;);\n    var pair;\n    var key, value;\n    var i, len;\n\n    for (i = 0, len = pairs.length; i &lt; len; ++i) {\n        pair = pairs[i].split(&#39;=&#39;);\n        // application/x-www-form-urlencoded编码会将&#39; &#39;转换为+\n        key = decodeURIComponent(pair[0]).replace(/\\+/g, &#39; &#39;);\n        value = decodeURIComponent(pair[1]).replace(/\\+/g, &#39; &#39;);\n\n        // 如果是新key，直接添加\n        if (!(key in result)) {\n            result[key] = value;\n        }\n        // 如果key已经出现一次以上，直接向数组添加value\n        else if (isArray(result[key])) {\n            result[key].push(value);\n        }\n        // key第二次出现，将结果改为数组\n        else {\n            var arr = [result[key]];\n            arr.push(value);\n            result[key] = arr;\n        } // end if-else\n    } // end for\n\n    return result;\n}\n\nfunction isArray(arg) {\n    if (arg &amp;&amp; typeof arg === &#39;object&#39;) {\n        return Object.prototype.toString.call(arg) === &#39;[object Array]&#39;;\n    }\n    return false;\n}\n/**\nconsole.log(parseQuery(&#39;sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8&#39;));\n */\n</code></pre>",
    "options": []
}